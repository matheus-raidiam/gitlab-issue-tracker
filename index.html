<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Open Finance Brasil - GitLab Issues</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <img src="Raidiam_icon.png" alt="Raidiam Logo"/>
    <h1 data-i18n="title">Open Finance Brasil - GitLab Issues</h1>
  </header>

  <p class="page-intro" data-i18n="intro">
    This dashboard pulls issues from the Open Finance GitLab project and gives a quick view of SLA risk, activity, and context. Use filters, sorting, and local notes to faster triage.
  </p>

  <!-- Toolbar -->
  <div class="toolbar">
    <label for="viewMode" style="font-weight:600" data-i18n="view">View:</label>
    <select id="viewMode" onchange="loadAllIssues()">
      <option value="open" data-i18n="openIssues">Open issues</option>
      <option value="closed14" data-i18n="closed14">Closed (last 14 days)</option>
      <option value="dashboard" data-i18n="dashboardView">Dashboard</option>
    </select>

    <!-- Closed issues custom range (visible only in Closed mode) -->
    <div id="closedRange" class="period-picker" style="display:none; margin-left:8px">
      <label for="closedFrom" data-i18n="from">From:</label>
      <input type="date" id="closedFrom"/>
      <label for="closedTo" data-i18n="to">To:</label>
      <input type="date" id="closedTo"/>
    </div>

    <!-- Ações -->
    <button class="icon-btn" id="refreshBtn" title="Refresh" data-i18n-title="refresh" onclick="loadAllIssues()">🔄</button>
    <button class="icon-btn" id="clearAllBtn" title="Clear All Comments" data-i18n-title="clearAll" onclick="clearAllComments()">🗑️</button>
    <button class="icon-btn" id="resetFiltersBtn" title="Reset Filters" data-i18n-title="resetFilters" onclick="resetAllFilters()">🧹</button>

    <div class="spacer"></div>

    <!-- Toggles -->
    <button id="themeToggle" class="icon-btn" title="Theme">🌓</button>
    <button id="langToggle"  class="icon-btn" title="Language">🌐</button>
    <button id="labelHistoryToggle" class="icon-btn" title="Label history">🕒</button>

    <div id="loading">Loading…</div>
  </div>

  <!-- SLA rules (collapsible) -->
  <div class="filters-card" style="margin-top:10px">
    <details>
      <summary style="cursor:pointer"><strong data-i18n="slaRules">SLA rules</strong></summary>
      <ul style="margin:8px 0 0 18px; line-height:1.45">
        <li data-i18n="rule1">Bug & Questions: 10 business days</li>
        <li data-i18n="rule2">Waiting Participant: 5 business days to receive an update</li>
        <li data-i18n="rule3">Under Evaluation or no tags: 3 business days</li>
        <li data-i18n="rule4">Under WG/DTO Evaluation, Backlog, Sandbox Testing, Waiting Deploy: SLA Paused</li>
        <li data-i18n="rule5">Production Testing, Change Request, Breaking Change, Test Improvement: No SLA</li>
      </ul>
    </details>
  </div>

  <!-- Filters (collapsible) -->
  <div class="filters-card">
    <details>
      <summary><strong data-i18n="filters">Filters</strong></summary>
      <div class="filters-row" style="margin-top:8px">
        <!-- Nature -->
        <div class="filter" id="filterNature">
          <details>
            <summary>
              <span class="title" data-i18n="nature">Nature</span>
              <span class="count-badge" id="count-nature">0</span>
            </summary>
            <div class="menu" id="menu-nature"></div>
          </details>
        </div>

        <!-- Platform -->
        <div class="filter" id="filterPlatform">
          <details>
            <summary>
              <span class="title" data-i18n="platform">Platform</span>
              <span class="count-badge" id="count-platform">0</span>
            </summary>
            <div class="menu" id="menu-platform"></div>
          </details>
        </div>

        <!-- Product -->
        <div class="filter" id="filterProduct">
          <details>
            <summary>
              <span class="title" data-i18n="product">Product</span>
              <span class="count-badge" id="count-product">0</span>
            </summary>
            <div class="menu" id="menu-product"></div>
          </details>
        </div>

        <!-- WG -->
        <div class="filter" id="filterWg">
          <details>
            <summary>
              <span class="title" data-i18n="wg">Working Group</span>
              <span class="count-badge" id="count-wg">0</span>
            </summary>
            <div class="menu" id="menu-wg"></div>
          </details>
        </div>

        <!-- Status -->
        <div class="filter" id="filterStatus">
          <details>
            <summary>
              <span class="title" data-i18n="status">Status</span>
              <span class="count-badge" id="count-status">0</span>
            </summary>
            <div class="menu" id="menu-status"></div>
          </details>
        </div>
      </div>
    </details>
  </div>

  <!-- Summary -->
  <div id="finance-summary" class="summary"></div>

  <!-- Table -->
  <div class="table-wrapper">
    <table id="finance-table" class="styled-table">
      <thead>
        <tr>
          <th data-key="iid" class="sortable" data-i18n="iidCol">IID</th>
          <th data-key="title" class="sortable" data-i18n="titleCol">Title</th>
          <th data-key="product" class="sortable" data-i18n="productCol">Product</th>
          <th data-key="wg" class="sortable" data-i18n="wgCol">Working<br>Group</th>
          <th data-key="status" class="sortable" data-i18n="statusCol">Status</th>
          <th data-key="daysOpen" class="sortable">SLA</th>
          <th data-key="dateCol" class="sortable" id="finance-date-label" data-i18n="createdAt">Created at</th>
          <th data-i18n="comments">Comments</th>
          <th data-i18n="close">Close</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Modal para notas -->
  <div id="noteModal" class="modal" style="display:none">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <h3 id="noteEditorTitle" style="margin:0"></h3>
        <button id="noteEditorClose">✖</button>
      </div>
      <div id="labelHistoryBody" style="margin-top:10px"></div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
